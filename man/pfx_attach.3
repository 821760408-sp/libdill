.\" Automatically generated by Pandoc 1.19.2.1
.\"
.TH "PFX_ATTACH" "3" "" "libdill" "libdill Library Functions"
.hy
.SH NAME
.PP
pfx_attach \- creates PFX protocol on top of underlying socket
.SH SYNOPSIS
.IP
.nf
\f[C]
#include\ <libdill.h>

int\ pfx_attach(int\ s);
\f[]
.fi
.SH DESCRIPTION
.PP
PFX is a message\-based protocol to send binary messages prefixed
by8\-byte size in network byte order.
The protocol has no initialhandshake.
Terminal handshake is accomplished by each peer sending eight0xFF bytes.
.PP
This function instantiates PFX protocol on top of the
underlyingprotocol.
.PP
\f[B]s\f[]: Handle of the underlying socket.
It must be a bytestream protocol.
.PP
The socket can be cleanly shut down using \f[B]pfx_detach\f[] function.
.PP
This function is not available if libdill is compiled with
\f[B]\-\-disable\-sockets\f[] option.
.SH RETURN VALUE
.PP
In case of success the function returns newly created socket handle.
In case of error it returns \-1 and sets \f[B]errno\f[] to one of the
values below.
.SH ERRORS
.IP \[bu] 2
\f[B]EBADF\f[]: Invalid handle.
.IP \[bu] 2
\f[B]EMFILE\f[]: The maximum number of file descriptors in the process
are already open.
.IP \[bu] 2
\f[B]ENFILE\f[]: The maximum number of file descriptors in the system
are already open.
.IP \[bu] 2
\f[B]ENOMEM\f[]: Not enough memory.
.IP \[bu] 2
\f[B]ENOTSUP\f[]: The handle does not support this operation.
.IP \[bu] 2
\f[B]EPROTO\f[]: Underlying socket is not a bytestream socket.
.SH EXAMPLE
.IP
.nf
\f[C]
int\ s\ =\ tcp_connect(&addr,\ \-1);
s\ =\ pfx_attach(s);
msend(s,\ "ABC",\ 3,\ \-1);
char\ buf[256];
ssize_t\ sz\ =\ mrecv(s,\ buf,\ sizeof(buf),\ \-1);
s\ =\ pfx_detach(s,\ \-1);
tcp_close(s);
\f[]
.fi
.SH SEE ALSO
.PP
\f[B]hclose\f[](3) \f[B]mrecv\f[](3) \f[B]mrecvl\f[](3)
\f[B]msend\f[](3) \f[B]msendl\f[](3) \f[B]pfx_attach_mem\f[](3)
\f[B]pfx_detach\f[](3)
